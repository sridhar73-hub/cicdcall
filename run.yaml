pool:
  name: 'testing'   # Use macOS or another OS depending on your requirement

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '6.x'         # Specify the version of the .NET SDK

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '**/*.trx'
    searchFolder: '$(System.DefaultWorkingDirectory)/TestResults'
    testRunTitle: 'Automated Test Run'

# Use the Azure DevOps CLI or a custom script to link the test results to Test Plans or Suites
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      # Using Azure DevOps REST API to update the Test Plan with test results
      curl -X POST \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer $(System.AccessToken)" \
      https://dev.azure.com/$(System.TeamProject)/_apis/testplan/Plans/$(TestPlanId)/suites/$(TestSuiteId)/results?api-version=7.0 \
      --data '{
        "testPlan": {
          "id": $(TestPlanId)
        },
        "testSuite": {
          "id": $(TestSuiteId)
        },
        "results": $(System.DefaultWorkingDirectory)/TestResults/*.trx
      }'
  displayName: 'Link Test Results to Test Plan and Test Suite'
